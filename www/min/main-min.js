"use strict";function setEmbedCode(){jQuery("#meetic-embed__content__url").text('<iframe src="'+document.location.href+'" frameborder="0" width="650" height="810" scrolling="no"></iframe>')}function createGraph(){if(jQuery(".graph div").length)jQuery(".graph div").fadeOut(function(){jQuery(".graph div").remove(),createGraph()});else{jQuery(".current-type").html(type);var e={top:0,right:0,bottom:0,left:0},t=550-e.left-e.right,n=212-e.top-e.bottom,r=d3.scale.category20c(),o=d3.layout.treemap().size([t,n]).sticky(!0).sort(function(e,t){return e.value-t.value}).value(function(e){return e[gender]}),i=d3.select(".graph").append("div").style("position","relative").style("width",t+e.left+e.right+"px").style("height",n+e.top+e.bottom+"px").style("left",e.left+"px").style("top",e.top+"px");d3.json("datas.json",function(e,t){var n=t[type][region];i.datum(n).selectAll(".node").data(o.nodes).enter().append("div").attr("class","node").call(position).style("background-color",function(e){return e.children?"#035669":"#81BFC8"}).on("mouseover",function(e){if(e.parent){var t=e.value/e.parent.value*100;jQuery(".treemap-description p").removeClass("default-message").html(e.name),jQuery(".treemap-description span").html("<strong>"+t.toPrecision(t>1?3:2).replace(".",",")+"</strong>%").show(),jQuery(this).css("background-color","#f5bb11")}}).on("mouseout",function(e){e.parent&&(jQuery(".treemap-description p").addClass("default-message").html("Survolez les zones"),jQuery(".treemap-description span").empty().hide(),jQuery(this).css("background-color","#7fbfc9"))}),jQuery("body").addClass("graph-ready")})}setEmbedCode()}function position(){var e=0;this.style("left",function(e){return e.x+"px"}).style("top",function(e){return e.y+"px"}).style("width",function(t){return Math.max(0,t.dx-1-e)+"px"}).style("height",function(t){return Math.max(0,t.dy-1-e)+"px"})}function setType(e){type=e,jQuery("#type-"+type).attr("CHECKED","CHECKED"),createGraph()}function showButton(){jQuery('[name="region"]:checked').val()&&jQuery('[name="gender"]:checked').val()&&jQuery(".show-step2").css("visibility","visible")}var type="manies",region,gender;d3.json("datas.json",function(e,t){if(jQuery.each(t.regions,function(e,t){jQuery(".region ul").append('<label for="region-'+e+'">'+t+' <input type="radio" name="region" id="region-'+e+'" value="'+e+'"></label>')}),document.location.hash.length){var n=document.location.hash.match(/#([\w\-]+)\,([\w\-]+)\,(\w+)/);if(n){type=n[1],jQuery("#type-"+type).attr("CHECKED","CHECKED"),region=n[2],jQuery("#region-"+region).attr("CHECKED","CHECKED"),gender=n[3],jQuery("#gender-"+gender).attr("CHECKED","CHECKED");var r=jQuery(".dashboard-selection__gender");r.find("p").addClass("dashboard-selection__gender-"+gender),r.find("span").html(jQuery("#gender-"+gender).next("em").text());var o=jQuery(".dashboard-selection__region");o.find("p").removeAttr("class").addClass("region-"+region),o.find("span").empty().html(t.regions[region])}}type&&region&&gender&&(createGraph(),jQuery(".step-1").fadeOut("slow",function(){jQuery(".step-2").fadeIn("slow")})),jQuery("input").on("change",function(){type=jQuery('[name="type"]:checked').val(),region=jQuery('[name="region"]:checked').val(),gender=jQuery('[name="gender"]:checked').val(),type&&region&&gender&&(document.location.href=document.location.pathname+"#"+type+","+region+","+gender,createGraph())})});var activeGender=function(){jQuery(".gender-selection__item").on("click",function(){var e=jQuery(this),t=jQuery(".dashboard-selection__gender");jQuery(".gender-selection__item").removeClass("active"),e.addClass("active"),t.find("p").addClass("dashboard-selection__"+e.find("input").attr("id")),t.find("span").html(e.find("em").html()),showButton()})},showSteps=function(){jQuery(".show-step2").on("click",function(){jQuery(".step-1").fadeOut("slow",function(){jQuery(".step-2").fadeIn("slow")})}),jQuery(".show-step1").on("click",function(){jQuery(".step-2").fadeOut("slow",function(){jQuery(".step-1").fadeIn("slow")})})},regionLocator=function(){jQuery(".map").find("polyline, polygon, span").on("click",function(){var e=jQuery(this),t=e.data("region"),n=e.data("title"),r=jQuery(".dashboard-selection__region");jQuery("#"+t).click(),jQuery(".map").find("polyline, polygon, span").each(function(e){jQuery(this).removeAttr("id")}),e.attr("id","active"),r.find("p").removeAttr("class").addClass(t),r.find("span").empty().html(n),showButton()})},colorboxEmbed=function(){jQuery(".inline").colorbox({inline:!0,height:"280px",width:"50%",onComplete:function(){jQuery("#meetic-embed__content").find("textarea").select()}})};jQuery(document).ready(function(){activeGender(),showSteps(),jQuery(".tooltip").tooltipster({position:"top-left"}),regionLocator(),colorboxEmbed()});